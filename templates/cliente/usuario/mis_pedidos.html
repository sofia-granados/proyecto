{% extends 'cliente/base_cliente.html' %}

{% block title %}Mis Pedidos - Chofys Pet's{% endblock %}

{% block content %}
<div style="max-width: 1200px; margin: 0 auto;">
    <h1 style="color: #4a5568; margin-bottom: 30px;">Mis Pedidos</h1>
    
    {% if pedidos %}
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>Pedido #</th>
                    <th>Fecha</th>
                    <th>Productos</th>
                    <th>Total (con IVA)</th>
                    <th>Estado</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                {% for pedido in pedidos %}
                <tr>
                    <td>#{{ pedido.id_pedido }}</td>
                    <td>{{ pedido.fecha_creacion|date:"d/m/Y H:i" }}</td>
                    <td>
                        {% with detalles=pedido.detalles.all %}
                            {% if detalles %}
                                {{ detalles.count }} producto{{ detalles.count|pluralize }}
                            {% else %}
                                Sin productos
                            {% endif %}
                        {% endwith %}
                    </td>
                    <td>${{ pedido.total }}</td>
                    <td>
                        {% if pedido.estado == 'PENDIENTE' %}
                        <span class="badge badge-pendiente">Pendiente</span>
                        {% elif pedido.estado == 'PAGADO' %}
                        <span class="badge badge-pagado">Pagado</span>
                        {% elif pedido.estado == 'ENVIADO' %}
                        <span class="badge badge-enviado">Enviado</span>
                        {% elif pedido.estado == 'ENTREGADO' %}
                        <span class="badge badge-entregado">Entregado</span>
                        {% elif pedido.estado == 'CANCELADO' %}
                        <span class="badge badge-cancelado">Cancelado</span>
                        {% endif %}
                    </td>
                    <td>
                        <a href="{% url 'cliente:detalle_mi_pedido' pedido_id=pedido.id_pedido %}" 
                           class="btn" style="background: #e2e8f0; color: #4a5568; padding: 5px 10px; font-size: 0.9rem;">
                            Ver Detalles
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    
    <!-- Estadísticas -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 40px;">
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">Total Gastado</h3>
            <p style="color: #2d3748; font-size: 1.5rem; font-weight: bold;">
                ${{ pedidos.0.total|default:0 }}
            </p>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">Pedidos Totales</h3>
            <p style="color: #2d3748; font-size: 1.5rem; font-weight: bold;">
                {{ pedidos.count }}
            </p>
        </div>
        
        <div style="background: white; padding: 20px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
            <h3 style="color: #718096; font-size: 0.9rem; margin-bottom: 10px;">Último Pedido</h3>
            <p style="color: #2d3748; font-size: 1.1rem; font-weight: bold;">
                #{{ pedidos.0.id_pedido|default:"N/A" }}
            </p>
        </div>
    </div>
    
    {% else %}
    <div style="text-align: center; padding: 60px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.1);">
        <h3 style="color: #718096; margin-bottom: 20px;">Aún no has realizado ningún pedido</h3>
        <p style="color: #718096; margin-bottom: 30px;">
            ¡Explora nuestros productos y realiza tu primera compra!
        </p>
        <a href="{% url 'cliente:index_cliente' %}" class="btn btn-primary" style="padding: 12px 30px;">
            Comenzar a Comprar
        </a>
    </div>
    {% endif %}
    
    <!-- Información sobre IVA -->
    <div style="background: #f8f9fa; padding: 25px; border-radius: 12px; margin-top: 40px;">
        <h3 style="color: #4a5568; margin-bottom: 15px;">Información Fiscal</h3>
        <p style="color: #718096; margin-bottom: 15px;">
            <strong>Todos los totales mostrados incluyen IVA (16%)</strong>
        </p>
        <p style="color: #718096; font-size: 0.9rem;">
            Puedes descargar tus facturas desde el detalle de cada pedido. 
            Las facturas se envían automáticamente a tu correo registrado.
        </p>
    </div>
</div>
{% endblock %}