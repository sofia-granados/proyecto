{% extends 'administracion/base.html' %}

{% block title %}Detalle Pedido - Chofys Pet's{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
        <h2 class="card-header">Detalle del Pedido #{{ pedido.id_pedido }}</h2>
        <!-- CORREGIDO: Agregar namespace 'administracion:' -->
        <a href="{% url 'administracion:ver_pedidos' %}" class="btn btn-secondary">Volver a Pedidos</a>
    </div>

    <div class="table-container">
        <div style="margin-bottom: 30px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
            <h3 style="color: #ff65a3; margin-bottom: 15px;">Informaci√≥n del Pedido</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <div>
                    <strong>ID Pedido:</strong><br>
                    #{{ pedido.id_pedido }}
                </div>
                <div>
                    <strong>Cliente:</strong><br>
                    {{ pedido.id_usuario.nombre }} {{ pedido.id_usuario.apepaterno }}
                </div>
                <div>
                    <strong>Correo:</strong><br>
                    {{ pedido.id_usuario.correo }}
                </div>
                <div>
                    <strong>Tel√©fono:</strong><br>
                    {{ pedido.id_usuario.telefono }}
                </div>
                <div>
                    <strong>Fecha de Creaci√≥n:</strong><br>
                    {{ pedido.fecha_creacion|date:"d/m/Y H:i" }}
                </div>
                <div>
                    <strong>Total:</strong><br>
                    <span style="font-size: 1.2rem; font-weight: bold; color: #ff65a3;">
                        ${{ pedido.total }}
                    </span>
                </div>
                <div>
                    <strong>Estado:</strong><br>
                    <span style="
                        padding: 8px 15px;
                        border-radius: 20px;
                        font-size: 14px;
                        font-weight: 600;
                        display: inline-block;
                        margin-top: 5px;
                        {% if pedido.estado == 'ENTREGADO' %}
                            background: #c8e6c9;
                            color: #2e7d32;
                            border: 1px solid #2e7d32;
                        {% elif pedido.estado == 'ENVIADO' %}
                            background: #bbdefb;
                            color: #1565c0;
                            border: 1px solid #1565c0;
                        {% elif pedido.estado == 'PAGADO' %}
                            background: #fff9c4;
                            color: #f57f17;
                            border: 1px solid #f57f17;
                        {% elif pedido.estado == 'PENDIENTE' %}
                            background: #ffcdd2;
                            color: #c62828;
                            border: 1px solid #c62828;
                        {% elif pedido.estado == 'CANCELADO' %}
                            background: #e0e0e0;
                            color: #616161;
                            border: 1px solid #616161;
                        {% else %}
                            background: #f5f5f5;
                            color: #424242;
                            border: 1px solid #424242;
                        {% endif %}
                    ">
                        {{ pedido.estado }}
                    </span>
                </div>
            </div>
        </div>

        <h3 style="color: #ff65a3; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 2px solid #ffb3c6;">
            üì¶ Productos del Pedido
        </h3>
        
        {% if detalles %}
        <table>
            <thead>
                <tr>
                    <th>#</th>
                    <th>Producto</th>
                    <th>Tipo</th>
                    <th>Categor√≠a</th>
                    <th>Cantidad</th>
                    <th>Precio Unitario</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for detalle in detalles %}
                <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>
                        {% if detalle.alimento %}
                            üçñ {{ detalle.alimento.nombre }}
                        {% elif detalle.accesorio %}
                            üéæ {{ detalle.accesorio.nombre }}
                        {% elif detalle.mascota %}
                            üê∂ {{ detalle.mascota.nombre }}
                        {% else %}
                            üì¶ Producto gen√©rico
                        {% endif %}
                    </td>
                    <td>
                        {% if detalle.alimento %}
                            {{ detalle.alimento.id_tipo.nombre }}
                        {% elif detalle.accesorio %}
                            {{ detalle.accesorio.id_tipo.nombre }}
                        {% elif detalle.mascota %}
                            {{ detalle.mascota.id_tipo.nombre }}
                        {% endif %}
                    </td>
                    <td>
                        {% if detalle.alimento %}
                            {{ detalle.alimento.id_categoria.nombre }}
                        {% elif detalle.accesorio %}
                            {{ detalle.accesorio.id_categoria.nombre }}
                        {% elif detalle.mascota %}
                            {{ detalle.mascota.id_categoria.nombre }}
                        {% endif %}
                    </td>
                    <td>{{ detalle.cantidad }}</td>
                    <td>${{ detalle.precio_unitario }}</td>
                    <td>
                        <strong style="color: #ff65a3;">${{ detalle.subtotal }}</strong>
                    </td>
                </tr>
                {% endfor %}
                
                <!-- RESUMEN TOTAL -->
                <tr style="background: linear-gradient(135deg, #ffe6f2 0%, #ffccf9 100%); font-weight: bold; font-size: 1.1rem;">
                    <td colspan="6" style="text-align: right; padding: 15px;">
                        TOTAL DEL PEDIDO:
                    </td>
                    <td style="padding: 15px; font-size: 1.2rem; color: #ff65a3;">
                        ${{ pedido.total }}
                    </td>
                </tr>
            </tbody>
        </table>
        {% else %}
        <div style="text-align: center; padding: 40px; background: #f8f9fa; border-radius: 8px; margin: 20px 0;">
            <p style="font-size: 1.1rem; color: #666;">Este pedido no tiene productos agregados.</p>
        </div>
        {% endif %}

        <!-- ACCIONES -->
        <div class="action-buttons" style="display: flex; justify-content: center; gap: 15px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #eee;">
            <!-- CORREGIDO: Agregar namespace 'administracion:' -->
            <a href="{% url 'administracion:cambiar_estado_pedido' pedido.id_pedido %}" class="btn btn-primary" style="padding: 12px 30px;">
                ‚úèÔ∏è Cambiar Estado
            </a>
            <a href="{% url 'administracion:eliminar_pedido' pedido.id_pedido %}" class="btn btn-danger" style="padding: 12px 30px;">
                üóëÔ∏è Eliminar Pedido
            </a>
            {% if pedido.estado != 'CANCELADO' and pedido.estado != 'ENTREGADO' %}
            <a href="{% url 'administracion:agregar_venta' %}?pedido={{ pedido.id_pedido }}" class="btn btn-success" style="padding: 12px 30px;">
                üí∞ Registrar Venta
            </a>
            {% endif %}
            <a href="{% url 'administracion:ver_pedidos' %}" class="btn btn-secondary" style="padding: 12px 30px;">
                ‚Ü©Ô∏è Volver a Pedidos
            </a>
        </div>

        <!-- INFORMACI√ìN ADICIONAL -->
        <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #4dabf7;">
            <h4 style="color: #1971c2; margin-bottom: 10px;">üìã Informaci√≥n del Cliente</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                <div>
                    <strong>Nombre completo:</strong><br>
                    {{ pedido.id_usuario.nombre }} {{ pedido.id_usuario.apepaterno }} {{ pedido.id_usuario.apematerno }}
                </div>
                <div>
                    <strong>Domicilio:</strong><br>
                    {{ pedido.id_usuario.domicilio }}
                </div>
                <div>
                    <strong>Ciudad:</strong><br>
                    {{ pedido.id_usuario.ciudad }}, {{ pedido.id_usuario.estado }}
                </div>
                <div>
                    <strong>C√≥digo Postal:</strong><br>
                    {{ pedido.id_usuario.codigo_postal }}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}